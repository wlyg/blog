# 数据库范式与事务
## 数据库范式
```
- 第一范式（1NF）：属性不可分。
- 第二范式（2NF）：符合1NF，并且，非主属性完全依赖于码（关键主属性）。
- 第三范式（3NF）：符合2NF，并且，消除传递依赖。
- BC范式（BCNF）：符合3NF，并且，主属性不依赖于主属性。
- 第四范式：要求把同一表内的多对多关系删除。
- 第五范式：从最终结构重新建立原始结构。
```
## 数据库事务
#### Propagation （事务的传播属性）
```
- PROPAGATION_REQUIRED：支持当前事务，如果当前没有事务，就新建一个事务。这是最常见的选择。
- PROPAGATION_SUPPORTS：支持当前事务，如果当前没有事务，就以非事务方式执行。
- PROPAGATION_MANDATORY：支持当前事务，如果当前没有事务，就抛出异常。
- PROPAGATION_REQUIRES_NEW：新建事务，如果当前存在事务，把当前事务挂起。
- PROPAGATION_NOT_SUPPORTED：以非事务方式执行操作，如果当前存在事务，就把当前事务挂起。
- PROPAGATION_NEVER：以非事务方式执行，如果当前存在事务，则抛出异常。
```
#### 数据库事务的四大特性（简称ACID）
- **原子性（Atomicity）**：事务的原子性指的是，事务中包含的程序作为数据库的逻辑工作单位，它所做的对数据修改操作要么全部执行，要么完全不执行。这种特性称为原子性。
例如银行取款事务分为2个步骤(1)存折减款(2)提取现金。不可能存折减款，却没有提取现金。2个步骤必须同时完成或者都不完成。
- **一致性（Consistency）**:事务的一致性指的是在一个事务执行之前和执行之后数据库都必须处于一致性状态。这种特性称为事务的一致性。假如数据库的状态满足所有的完整性约束，就说该数据库是一致的。例如完整性约束a+b=10，一个事务改变了a，那么b也应随之改变。
- **分离性（亦称独立性或隔离性Isolation）**:分离性指并发的事务是相互隔离的。即一个事务内部的操作及正在操作的数据必须封锁起来，不被其它企图进行修改的事务看到。假如并发交叉执行的事务没有任何控制，操纵相同的共享对象的多个并发事务的执行可能引起异常情况。
- **持久性(Durability)**:持久性意味着当系统或介质发生故障时，确保已提交事务的更新不能丢失。即一旦一个事务提交，DBMS保证它对数据库中数据的改变应该是永久性的。持久性通过数据库备份和恢复来保证。
#### 事务的隔离级别
- **ISOLATION_READ_UNCOMMITTED（读取未提交）**：这是事务最低的隔离级别，它充许令外一个事务可以看到这个事务未提交的数据。这种隔离级别会产生脏读，不可重复读和幻读。
- **ISOLATION_READ_COMMITTED（读取已提交）**：保证一个事务修改的数据提交后才能被另外一个事务读取。另外一个事务不能读取该事务未提交的数据，这种隔离级别会产生不可重复读和幻读。
以上2、3两种级别是针对更新事物的限制，在读取事物进行时，是不会有任何限制的。所以会出现不可重复读（读取时，有更新），和幻读（读取时，有插入）。
- **ISOLATION_REPEATABLE_READ（可重复的读取）**：一个事物读取时，不允许更新，但允许插入。不会出现脏读、不可重复读，但会出现幻读。
- **ISOLATION_SERIALIZABLE（序列化）**：这是花费最高代价但是最可靠的事务隔离级别。事务被处理为顺序执行。除了防止脏读，不可重复读外，还避免了幻读。
#### 什么是脏数据，脏读，不可重复读，幻觉读？
- **脏读**：指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是脏数据，依据脏数据所做的操作可能是不正确的。
- **不可重复读**：指在一个事务内，多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的数据可能是不一样的。这样就发生了在一个事务内两次读到的数据是不一样的，因此称为是不可重复读。
- **幻读**：也称虚读，指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。